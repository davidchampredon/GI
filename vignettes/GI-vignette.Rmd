---
title: "GI package: Generation Interval Distributions for Epidemic Models"
author: "David Champredon"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Vignette Title}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

The `GI` package implements the theoretical results published in:

[1] Champredon D, Dushoff J. *Intrinsic and realized generation intervals in infectious-disease transmission.* Proceedings of the Royal Society B: Biological Sciences (2015); 282: 20152026. [open access link](http://rspb.royalsocietypublishing.org/content/282/1821/20152026)



## Summary of theoretical framework

The generation interval is the interval between the time when an individual is infected by an infector and the time when this infector was infected. There are three conceptually different generation interval distributions:
 
 * __intrinsic__ generation interval: defines the transmission process in the mathematical model 
 * __forward__ generation interval: observed when a cohort is tracked forward in time to see whom individuals infect
 * __backward__ generation interval: observed when a cohort is investigated by looking backward in time to see
who infected each individual. This generation interval is important when fitting a model to contact tracing data.

For a classical compartmental model (like the SIR model), the generation interval distributions are not explicitly defined and calculating them is not straightforward. 

Similarly, when using a renewal equation to model an epidemic, although the _intrinsic_ generation interval is explicitly defined, both the backward and forward generation intervals are not explicitly defined and calculating them is not straightforward. 

The `GI` package provides easy-to-use functions to calculate the various generation interval distributions.


## Epidemic models implemented

### SEmInR

The SEmInR model is an extension of the popular SEIR model, where $m$ E ("exposed") compartments and $n$ I ("infectious") compartments were introduced artificially in order to have latent and infectious durations distributed more realistically. See [1] for more details on this model.


### RESuDe

Although less popular than compartmental models, it is also possible to model infectious disease transmission with Lotka-Euler's renewal equation. If we note $S_t$ the number of susceptible at time $t$, $I_t$ the _incidence_ at time $t$ (not the prevalence!), $\mathcal{R}_0$ the basic reproduction number, $N$ the constant total population size and $g$ the _intrinsic_ generation interval distribution, we have:
$$ I_t = \mathcal{R}_0 \frac{S_t}{N}\sum_{s=1}^t g(s)\, I_{t-s}$$
$$ S_t = S_{t-1} - I_t$$

Note that this model is defined at _discrete_ times. The susceptible depletion given by the second equation prevent the model to have an exponential growth for ever. This feature defines the label of this model: Renewal Equation with Suceptible Depletion, or "RESuDe".

This model can be slightly more sophisticated and we can introduce:

 * mixing heterogeneity by adding a multiplicative factor $(S_t/N)^\alpha$ for $\alpha\geq 0$
 * intervention effects by adding a multiplicative factor that decreases the force of infection through time $e^{-\kappa t}$ for $\kappa\geq 0$

Hence, the first equation becomes (the second equation, susceptible depletion, is unchanged):
$$ I_t = \mathcal{R}_0 \left(\frac{S_t}{N}\right)^\alpha e^{-\kappa t} \sum_{s=1}^t g(s)\, I_{t-s}$$


## Example to visualize the temporal evolution of GI distributions

### Example with SEmInR model

Let's start by defining the model parameters:
```{r, echo=TRUE,message=FALSE, warning=FALSE}
library(GI)
latent_mean     <- 5  # Mean duration of latent period (in days)
infectious_mean <- 5  # Mean duration of infectious period (in days)
R0 <- 4
nE <- 3  # Number of artifical 'E' compartments
nI <- 3  # Number of artifical 'E' compartments
horizon <- 100  # make sure simulations last long enough, until the end of the epidemic.
```

Now, let's define the (calendar) times where we want to calculate the forward and backward generation interval distributions (the intrinsic one is constant througout the epidemic):
```{r}
cal.times.fwdbck <- seq(5, horizon-10, by=5)
```
Let's call the `GI.seminr` function to calculate all three generation interval distributions at these calendar times:
```{r,cache=T}
g <- GI.seminr(latent_mean, infectious_mean, R0, nE,nI, cal.times.fwdbck,horizon)
```
The results are stored in list, so lets retrieve them:
```{r}
g.int <- g[['intrinsic']]
g.fwd <- g[['fwd']]
g.bck <- g[['bck']]
t     <- g[['cal.times']]
inc   <- g[['incidence']]
```

In order to understand the temporal evolution of the forward and backward generation interval distributions, let's make some plots. First, we plot the incidence time series generated by the model, as this is one of the fundamental component affecting forward and backward generation interval distributions.

```{r,fig.width=7}
plot(x=t, y=inc, typ='l', 
	 main = "SEmInR simulated incidence",
	 xlab = 'calendar time', ylab='', las=1,lwd=2) ; grid()
```

Now, let's look at the _intrinsic_ generation interval distribution:
```{r,fig.width=7}
plot(g.int$tsi, g.int$density, 
	 typ='l', col='red', lwd=3,
	 xlim = c(0,30),
	 xlab = 'time since infection', ylab ='',yaxt='n',
	 main='Intrinsic generation interval distribution')
```
This intrinsic distribution will __not__ change throughout the epidemic. 

Now, let's look at the forward generation interval distributions, at each calendar times requested in `cal.times.fwdbck`.
```{r,fig.width=7}
plot(x=g.fwd$tsi[[1]], y = g.fwd$density[[1]],
	 main = 'Forward generation interval distribution',
	 xlab = 'time since infection', ylab ='',yaxt='n',
	 xlim = c(0,30), col=rgb(0,0,0,0.2),
	 typ='l',ylim=c(0,0.2))
for(i in 1:length(g.fwd$tsi)) 
	lines(x=g.fwd$tsi[[i]],g.fwd$density[[i]],col=rgb(0,0,0,0.2))
```
Each grey line represents the distribution at a different calendar time, we can see that it is different. 



### Example with RESuDe model



## Contact-tracing data example

In an epidemic investigation of an on-going outbreak, contact tracing typically provides _backward_ generation interval: an infectee was infected at time $t_1$ and her identified infector was infected at time $t_0$. The backward generation interval is simply $t_1-t_0$.
Hence, for a mathematical model used to analyze this outbreak, if contact tracing data is available and the modeller is willing to fit this model to such data, it is important to fit the _backward_ generation interval (not the intrinsic, as may happen with a naive approach).


```{r, fig.show='hold',fig.cap = "Your figure caption."}

# TO DO 
```

